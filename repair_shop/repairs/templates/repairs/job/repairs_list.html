{% extends "repairs/base.html" %}
{% load custom_tags %} 

{% block title %}Jobs {% endblock%}

{% block body %}
<div class="toolbar">
    <a href="{% url 'repairs:check_in'%}" class="btn-primary">Check In device</a>
        <input
        type="search"
        id="SearchRepairs"
        name="SearchRepairs"
        class="searchbar"
        placeholder="Search repairs..."
        hx-get="{% url 'repairs:search_repairs' %}"
        hx-trigger="input  delay:500ms"
        hx-target="#RepairTable"
        hx-swap="innerHTML"
        />
        <br>
        
    </div>
    <div>
        <h1><strong>Checked In</strong></h1>
        <table class="inventory-table" id="companytable" >
            <thead>
                <tr>
                        <th>brand</th>
                        <th>device name</th>
                        <th>shipped from</th>
                        <th>time checked in</th>
                        <th></th>
                        <th></th>
                </tr>
            </thead>
            <tbody >
                {% for repair in checked_in %}
                <tr class="{% cycle 'odd-row' 'even-row' %} " id="component-{{ item.id }}">
                            <td>{{ repair.device.brand }}</td>
                            <td>{{ repair.device.device_name }}</td>
                            <td>{{ repair.device.shipped_from }}</td>
                            <td>{{ repair.device.created_at }}</td>
                            <td></td>
                        <td><a href="{% url 'repairs:assigning' repair.pk %}" class="btn-primary">Assign to</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>


        <h1><strong>Repairs</strong></h1>
        <table class="inventory-table" id="RepairTable" >
            <thead>
                <tr>
                        <th>job number</th>
                        <th>brand</th>
                        <th>device name</th>
                        <th>assigned to</th>
                        <th>time checked in</th>
                        <th>complain</th>
                        <th>status</th>
                        <th></th>
                        <th></th>
                </tr>
            </thead>
            <tbody >
                {% for repair in repairs %}
                    <tr class="{% cycle 'odd-row' 'even-row' %} " id="component-{{ item.id }}">
                        <td>{{ repair.job_number }}</td>
                        <td>{{ repair.device.brand }}</td>
                        <td>{{ repair.device.device_name }}</td>
                        <td>{{ repair.assigned_to }}</td>
                        <td>{{ repair.device.created_at }}</td>
                        <td>{{ repair.complain }}</td>
                        <td>{{ repair.state }}</td>
                        <td></td>
            {% with transitions=repair.get_available_state_transitions %}
                    {% if transitions %}
                        {% for transition in transitions %}
                                <td><a href="{% url 'repairs:'|add:transition.name repair.pk %}" class="btn-primary">Next step</a></td>
                        {% endfor %}
                    {% else %}
                    (No actions available)
                    {% endif %}
            {% endwith %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h1><strong>Done</strong></h1>
        <table class="inventory-table" id="companytable" >
            <thead>
                <tr>
                        <th>job number</th>
                        <th>brand</th>
                        <th>device name</th>
                        <th>assigned to</th>
                        <th>time checked in</th>
                        <th>complain</th>
                        <th>status</th>
                        <th></th>
                        <th></th>
                </tr>
            </thead>
            <tbody >
                {% for repair in shipped %}
                    <tr class="{% cycle 'odd-row' 'even-row' %} " id="component-{{ item.id }}">
                        <td>{{ repair.job_number }}</td>
                        <td>{{ repair.device.brand }}</td>
                        <td>{{ repair.device.device_name }}</td>
                        <td>{{ repair.assigned_to }}</td>
                        <td>{{ repair.device.created_at }}</td>
                        <td>{{ repair.complain }}</td>
                        <td>{{ repair.state }}</td>
                        <td></td>
            {% with transitions=repair.get_available_state_transitions %}
                    {% if transitions %}
                        {% for transition in transitions %}
                                <td><a href="{% url 'repairs:repair_detail' repair.pk %}" class="btn-primary">view</a></td>
                        {% endfor %}
                    {% else %}
                    (No actions available)
                    {% endif %}
            {% endwith %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

